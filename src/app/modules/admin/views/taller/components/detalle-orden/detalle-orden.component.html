<h2 mat-dialog-title>游댢 Consulta de reparaci칩n</h2>

<mat-dialog-content>

  <!-- Formulario de b칰squeda -->
  <mat-card class="consulta-card">
<!-- 
    <mat-card-header>
      <mat-card-subtitle>
        Ingres치 el n칰mero de orden y DNI para conocer el estado de tu equipo.
      </mat-card-subtitle>
    </mat-card-header> -->

    <mat-card-content>
      <form [formGroup]="consultaForm" (ngSubmit)="buscar()" class="consulta-form">

        <!-- N칰mero de orden -->
        <mat-form-field appearance="outline">
          <mat-label>N칰mero de orden</mat-label>
          <input matInput formControlName="numeroOrden" placeholder="Ej: 12345" type="number">
          <mat-error *ngIf="consultaForm.get('numeroOrden')?.hasError('required')">
            El n칰mero de orden es obligatorio
          </mat-error>
        </mat-form-field>

        <!-- DNI -->
        <mat-form-field appearance="outline">
          <mat-label>DNI</mat-label>
          <input matInput formControlName="dni" placeholder="Ej: 30123456" type="number">
          <mat-error *ngIf="consultaForm.get('dni')?.hasError('required')">
            El DNI es obligatorio
          </mat-error>
        </mat-form-field>

        <!-- Bot칩n -->
        <button mat-raised-button color="primary"
                type="submit"
                [disabled]="consultaForm.invalid || buscando">
          {{ buscando ? 'Buscando...' : 'Buscar' }}
        </button>

      </form>

      <!-- Mensaje de error -->
      <div *ngIf="mensajeError" class="mensaje-error">
        <mat-icon color="warn">error</mat-icon>
        {{ mensajeError }}
      </div>

    </mat-card-content>
  </mat-card>

  <!-- Resultado -->
  <div *ngIf="resultado as orden" class="mt-4">

    <!-- Encabezado -->
    <mat-card class="mb-3">
      <mat-card-content>
        <h4 class="mb-1">{{ orden.nombreCliente }} {{ orden.apellidoCliente }}</h4>
        <p class="mb-0 text-muted">
          Orden N췈 <strong>{{ orden.numeroOrden }}</strong>
        </p>
        <span class="badge"
              [ngClass]="{
                'bg-success': orden.estado === 'Listo',
                'bg-warning text-dark': orden.estado === 'En reparaci칩n',
                'bg-danger': orden.estado === 'Pendiente'
              }">
          {{ orden.estado }}
        </span>
      </mat-card-content>
    </mat-card>

    <!-- Datos del equipo -->
    <mat-card class="mb-3">
      <mat-card-content>
        <h5>Equipo</h5>
        <p class="mb-1"><strong>Modelo:</strong> {{ orden.equipo }}</p>
        <p class="mb-1"><strong>IMEI:</strong> {{ orden.imei }}</p>
        <p class="mb-0"><strong>Motivo de ingreso:</strong> {{ orden.motivoIngreso }}</p>
      </mat-card-content>
    </mat-card>

    <!-- Fechas -->
    <mat-card class="mb-3">
      <mat-card-content>
        <h5>Fechas</h5>
        <p class="mb-1"><strong>Ingreso:</strong> {{ orden.fechaIngreso | date }}</p>
        <p *ngIf="orden.fechaEntrega" class="mb-1">
          <strong>Entrega estimada:</strong> {{ orden.fechaEntrega | date }}
        </p>
        <p *ngIf="orden.garantia && orden.fechaGarantia" class="mb-0">
          <strong>Garant칤a hasta:</strong> {{ orden.fechaGarantia | date }}
        </p>
      </mat-card-content>
    </mat-card>

    <!-- Observaciones -->
    <mat-card *ngIf="orden.observaciones?.length">
      <mat-card-content>
        <h5>Observaciones</h5>
        <ul class="mb-0">
          <li *ngFor="let obs of orden.observaciones">{{ obs }}</li>
        </ul>
      </mat-card-content>
    </mat-card>

  </div>

</mat-dialog-content>