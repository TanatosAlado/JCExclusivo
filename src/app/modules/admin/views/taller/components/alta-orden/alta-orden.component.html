<div class="imagen-central fadeIn first">
  <img src="../../../../../assets/logo.png" alt="Login" />
</div>

<mat-card class="producto-form-card">
  <mat-card-content>
    <form [formGroup]="ordenForm" (ngSubmit)="onSubmit()">

      <!-- Datos del cliente -->
      <div class="form-grid fadeIn first">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>DNI</mat-label>
          <input matInput formControlName="dniCliente" type="number" (keydown.enter)="buscarCliente()"
            (blur)="buscarCliente()">

          <button mat-icon-button matSuffix type="button" (click)="buscarCliente()" title="Buscar Cliente">
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>
      </div>


      <div class="form-grid fadeIn second">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombreCliente" required>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Apellido</mat-label>
          <input matInput formControlName="apellidoCliente" required>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Teléfono</mat-label>
          <input matInput formControlName="telefonoCliente" required>
        </mat-form-field>
      </div>

      <!-- Datos del equipo -->
      <div class="form-grid fadeIn third">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>IMEI</mat-label>
          <input matInput formControlName="imei">
        </mat-form-field>

        <!-- Botón consultar IMEI -->
        <div class="imei-check">
          <button mat-stroked-button color="accent" type="button" (click)="consultarIMEI()">
            🔍 Consultar IMEI
          </button>
        </div>

<!-- Resultados de la consulta -->
<div *ngIf="imeiResultados && imeiResultados.length > 0" class="imei-resultados">
  <h4>Historial de reparaciones encontradas:</h4>

  <div class="resultado-card" *ngFor="let r of imeiResultados">
    <p><strong>📅 Fecha de ingreso:</strong> {{ r.fechaIngreso?.toDate() | date:'dd/MM/yyyy' }}</p>
    <p><strong>👤 Cliente:</strong> {{ r.nombreCliente }} {{ r.apellidoCliente }}</p>
    <p><strong>📝 Motivo:</strong> {{ r.motivoIngreso }}</p>
    
    <div *ngIf="r.observaciones?.length">
      <p><strong>🔍 Observaciones:</strong></p>
      <ul>
        <li *ngFor="let obs of r.observaciones">{{ obs }}</li>
      </ul>
    </div>
  </div>
</div>

        <div *ngIf="imeiResultados && imeiResultados.length === 0" class="imei-resultados">
          <p>✅ No se encontraron órdenes previas con este IMEI.</p>
        </div>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Equipo</mat-label>
          <input matInput formControlName="equipo" required>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Código de desbloqueo</mat-label>
          <input matInput formControlName="codigoDesbloqueo">
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Color del equipo</mat-label>
          <input matInput formControlName="colorEquipo">
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Motivo de ingreso</mat-label>
          <input matInput formControlName="motivoIngreso" required>
        </mat-form-field>
      </div>

      <!-- Otros campos -->
      <div class="form-grid fadeIn fourth">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Presupuesto (opcional)</mat-label>
          <input matInput formControlName="presupuesto" type="number">
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="form-field full-width fadeIn fourth">
        <mat-label>Observaciones</mat-label>
        <textarea matInput rows="3" formControlName="observaciones"></textarea>
      </mat-form-field>

      <!-- Botón Guardar y Cancelar -->
      <div class="acciones fadeIn fourth">
        <button mat-raised-button color="primary" type="submit" [disabled]="ordenForm.invalid">
          Guardar Orden
        </button>

        <button mat-button color="warn" type="button" (click)="cancelar()">
          Cancelar
        </button>
      </div>

    </form>

    <div class="spinner-overlay" *ngIf="cargando">
      <div class="spinner-box">
        <mat-progress-spinner mode="indeterminate" diameter="50" color="primary"></mat-progress-spinner>
        <p>Creando solicitud de reparación...</p>
      </div>
    </div>

  </mat-card-content>
</mat-card>