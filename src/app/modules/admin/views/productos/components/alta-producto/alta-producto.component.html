<div class="container mt-4">

  <h2 class="mb-4 text-center">Alta de producto</h2>

  <!--  Selecci贸n de tipo de producto -->
  <div class="d-flex justify-content-center gap-3 mb-4">
    <button class="btn btn-outline-primary"
            (click)="seleccionarTipo('none')"
            [class.active]="tipoSeleccionado === 'none'">
      Producto 煤nico
    </button>

    <button class="btn btn-outline-primary"
            (click)="seleccionarTipo('color')"
            [class.active]="tipoSeleccionado === 'color'">
      Variante por color
    </button>

    <button class="btn btn-outline-primary"
            (click)="seleccionarTipo('modelo+color')"
            [class.active]="tipoSeleccionado === 'modelo+color'">
      Variante por modelo y color
    </button>
  </div>

  <hr>

  <!--  Formulario: Producto nico -->
  <div *ngIf="tipoSeleccionado === 'none'" class="card shadow p-4">

    <h4 class="mb-3">Datos del producto 煤nico</h4>

    <div class="row g-3">

      <div class="col-md-4">
        <label class="form-label">C贸digo de barras</label>
        <input type="text" class="form-control" [(ngModel)]="producto.codigoBarras">
      </div>

      <div class="col-md-8">
        <label class="form-label">Descripci贸n</label>
        <input type="text" class="form-control" [(ngModel)]="producto.descripcion">
      </div>

      <!--  Imagen -->
      <div class="col-md-12">
        <label class="form-label">URL de la imagen</label>
        <input type="text" class="form-control" placeholder="https://..." [(ngModel)]="producto.imagen">
      </div>

      <div class="col-md-3">
        <label class="form-label">Precio costo</label>
        <input type="number" class="form-control" [(ngModel)]="producto.precioCosto">
      </div>

      <div class="col-md-3">
        <label class="form-label">Precio sin impuestos</label>
        <input type="number" class="form-control" [(ngModel)]="producto.precioSinImpuestos">
      </div>

      <div class="col-md-3">
        <label class="form-label">Precio minorista</label>
        <input type="number" class="form-control" [(ngModel)]="producto.precioMinorista">
      </div>

      <div class="col-md-3">
        <label class="form-label">Precio mayorista</label>
        <input type="number" class="form-control" [(ngModel)]="producto.precioMayorista">
      </div>

      <div class="col-md-4">
        <label class="form-label">Rubro</label>
        <input type="text" class="form-control" [(ngModel)]="producto.rubro">
      </div>

      <div class="col-md-4">
        <label class="form-label">Subrubro</label>
        <input type="text" class="form-control" [(ngModel)]="producto.subrubro">
      </div>

      <div class="col-md-4">
        <label class="form-label">Marca</label>
        <input type="text" class="form-control" [(ngModel)]="producto.marca">
      </div>

      <div class="col-md-6 d-flex align-items-center">
        <input type="checkbox" class="form-check-input me-2" [(ngModel)]="producto.destacado">
        <label class="form-check-label">Destacado</label>
      </div>

      <div class="col-md-6 d-flex align-items-center">
        <input type="checkbox" class="form-check-input me-2" [(ngModel)]="producto.oferta">
        <label class="form-check-label">En oferta</label>
      </div>

      <div class="col-md-6" *ngIf="producto.oferta">
        <label class="form-label">Precio oferta</label>
        <input type="number" class="form-control" [(ngModel)]="producto.precioOferta">
      </div>

      <div class="col-md-6">
        <label class="form-label">Stock m铆nimo</label>
        <input type="number" class="form-control" [(ngModel)]="producto.stockMinimo">
      </div>
    </div>

    <hr class="my-4">

    <!--  Stock por sucursal -->
    <h5>Stock por sucursal</h5>
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead>
          <tr>
            <th>Sucursal</th>
            <th style="width: 150px;">Cantidad</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let s of sucursales; let i = index">
            <td>{{ s.nombre }}</td>
            <td>
              <input type="number"
                     class="form-control form-control-sm"
                     [(ngModel)]="producto.stockSucursales[i].cantidad">
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!--  Stock mayorista -->
    <div class="col-md-4 mt-3">
      <label class="form-label">Stock mayorista</label>
      <input type="number" class="form-control" [(ngModel)]="producto.stockMayorista">
    </div>

    <div class="mt-4 text-end">
      <button class="btn btn-success" (click)="guardarProductoUnico()">
        Guardar producto
      </button>
    </div>

  </div>


  <!--  Formulario: Producto con variantes por color -->
  <div *ngIf="tipoSeleccionado === 'color'" class="card shadow p-4" [formGroup]="form">
  <h4 class="mb-3">Producto con variantes por color</h4>

  <!-- З Datos generales -->
  <div class="row g-3">

    <!-- <div class="col-md-4">
      <label class="form-label">C贸digo base</label>
      <input type="text" class="form-control" formControlName="codigoBarras">
    </div> -->

    <div class="col-md-8">
      <label class="form-label">Descripci贸n</label>
      <input type="text" class="form-control" formControlName="descripcion">
    </div>

    <div class="col-md-12">
      <label class="form-label">Imagen (URL)</label>
      <input type="text" class="form-control" placeholder="https://..." formControlName="imagen">
    </div>

    <div class="col-md-3">
      <label class="form-label">Precio costo</label>
      <input type="number" class="form-control" formControlName="precioCosto">
    </div>

    <div class="col-md-3">
      <label class="form-label">Precio sin impuestos</label>
      <input type="number" class="form-control" formControlName="precioSinImpuestos">
    </div>

    <div class="col-md-3">
      <label class="form-label">Precio minorista</label>
      <input type="number" class="form-control" formControlName="precioMinorista">
    </div>

    <div class="col-md-3">
      <label class="form-label">Precio mayorista</label>
      <input type="number" class="form-control" formControlName="precioMayorista">
    </div>

    <div class="col-md-4">
      <label class="form-label">Rubro</label>
      <input type="text" class="form-control" formControlName="rubro">
    </div>

    <div class="col-md-4">
      <label class="form-label">Subrubro</label>
      <input type="text" class="form-control" formControlName="subrubro">
    </div>

    <div class="col-md-4">
      <label class="form-label">Marca</label>
      <input type="text" class="form-control" formControlName="marca">
    </div>

    <div class="col-md-6 d-flex align-items-center">
      <input type="checkbox" class="form-check-input me-2" formControlName="destacado">
      <label class="form-check-label">Destacado</label>
    </div>

    <div class="col-md-6 d-flex align-items-center">
      <input type="checkbox" class="form-check-input me-2" formControlName="oferta">
      <label class="form-check-label">En oferta</label>
    </div>

    <div class="col-md-6" *ngIf="form.get('oferta')?.value">
      <label class="form-label">Precio oferta</label>
      <input type="number" class="form-control" formControlName="precioOferta">
    </div>

    <div class="col-md-6">
      <label class="form-label">Stock m铆nimo</label>
      <input type="number" class="form-control" formControlName="stockMinimo">
    </div>
  </div>

  <hr class="my-4">

  <!--  Variantes por color -->
  <div formArrayName="variantes">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5>Variantes por color</h5>
      <button type="button" class="btn btn-sm btn-outline-primary" (click)="agregarVarianteColor()">
        + Agregar color
      </button>
    </div>

    <div *ngFor="let variante of variantes.controls; let i = index" [formGroupName]="i"
         class="card mb-3 border-0 shadow-sm p-3">

      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="m-0">Color {{ i + 1 }}</h6>
        <button type="button" class="btn btn-sm btn-outline-danger" (click)="eliminarVarianteColor(i)">Eliminar</button>
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Color</label>
          <input type="text" class="form-control" formControlName="color" placeholder="Ej: Rojo">
        </div>

        <div class="col-md-6">
          <label class="form-label">C贸digo de barras</label>
          <input type="text" class="form-control" formControlName="codigoBarras">
        </div>
      </div>

      <!--  Stock por sucursal -->
      <div class="mt-3" formArrayName="stockSucursales">
        <h6>Stock por sucursal</h6>
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Sucursal</th>
              <th style="width: 150px;">Cantidad</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let stock of variante.get('stockSucursales')['controls']; let j = index" [formGroupName]="j">
              <td>{{ getNombreSucursal(stock.get('sucursalId')?.value) }}</td>
              <td>
                <input type="number" formControlName="cantidad" class="form-control form-control-sm" min="0">
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!--  Stock mayorista -->
      <div class="col-md-4 mt-3">
        <label class="form-label">Stock mayorista</label>
        <input type="number" formControlName="stockMayorista" class="form-control" min="0">
      </div>
    </div>
  </div>

  <div class="mt-4 text-end">
    <button class="btn btn-success" (click)="guardarProductoColor()">
      Guardar producto con variantes
    </button>
  </div>
</div>

<!-- З Secci贸n PRODUCTO MODELO + COLOR -->
<!-- З Producto con variantes por modelo y color -->
<div *ngIf="tipoSeleccionado === 'modelo+color'" class="card shadow p-4" [formGroup]="form">

  <h4 class="mb-3">Producto con variantes por modelo y color</h4>

  <!--  Datos generales -->
  <div class="row g-3">

    <div class="col-md-8">
      <label class="form-label">Descripci贸n</label>
      <input type="text" class="form-control" formControlName="descripcion">
    </div>

    <div class="col-md-12">
      <label class="form-label">Imagen (URL)</label>
      <input type="text" class="form-control" placeholder="https://..." formControlName="imagen">
    </div>

    <div class="col-md-3">
      <label class="form-label">Precio costo</label>
      <input type="number" class="form-control" formControlName="precioCosto">
    </div>

    <div class="col-md-3">
      <label class="form-label">Precio sin impuestos</label>
      <input type="number" class="form-control" formControlName="precioSinImpuestos">
    </div>

    <div class="col-md-3">
      <label class="form-label">Precio minorista</label>
      <input type="number" class="form-control" formControlName="precioMinorista">
    </div>

    <div class="col-md-3">
      <label class="form-label">Precio mayorista</label>
      <input type="number" class="form-control" formControlName="precioMayorista">
    </div>

    <div class="col-md-4">
      <label class="form-label">Rubro</label>
      <input type="text" class="form-control" formControlName="rubro">
    </div>

    <div class="col-md-4">
      <label class="form-label">Subrubro</label>
      <input type="text" class="form-control" formControlName="subrubro">
    </div>

    <div class="col-md-4">
      <label class="form-label">Marca</label>
      <input type="text" class="form-control" formControlName="marca">
    </div>

    <div class="col-md-6 d-flex align-items-center">
      <input type="checkbox" class="form-check-input me-2" formControlName="destacado">
      <label class="form-check-label">Destacado</label>
    </div>

    <div class="col-md-6 d-flex align-items-center">
      <input type="checkbox" class="form-check-input me-2" formControlName="oferta">
      <label class="form-check-label">En oferta</label>
    </div>

    <div class="col-md-6" *ngIf="form.get('oferta')?.value">
      <label class="form-label">Precio oferta</label>
      <input type="number" class="form-control" formControlName="precioOferta">
    </div>

    <div class="col-md-6">
      <label class="form-label">Stock m铆nimo</label>
      <input type="number" class="form-control" formControlName="stockMinimo">
    </div>
  </div>

  <hr class="my-4">

  <!-- П Modelos y colores -->
  <h5 class="mb-3 fw-bold text-primary">Variantes por modelo y color</h5>

  <button class="btn btn-success btn-sm mb-3" (click)="agregarModelo()">+ Agregar modelo</button>

  <div formArrayName="variantes">
    <div *ngFor="let modelo of getVariantes().controls; let i = index" [formGroupName]="i" class="card mb-3 shadow-sm">

      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="fw-bold text-secondary">Modelo {{ i + 1 }}</h6>
          <button type="button" class="btn btn-outline-danger btn-sm" (click)="eliminarModelo(i)">Eliminar modelo</button>
        </div>

        <!-- Nombre del modelo -->
        <div class="mb-3">
          <label class="form-label">Nombre del modelo</label>
          <input type="text" formControlName="modelo" class="form-control" placeholder="Ej: iPhone 14">
        </div>

        <!--  Colores dentro de cada modelo -->
        <div formArrayName="colores" class="ms-3">
          <h6 class="fw-bold">Colores disponibles</h6>
          <button class="btn btn-primary btn-sm mb-2" (click)="agregarColor(i)">+ Agregar color</button>

          <div *ngFor="let color of getColores(i).controls; let j = index" [formGroupName]="j" class="border p-3 rounded mb-2 bg-light">

            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label">Color</label>
                <input type="text" formControlName="color" class="form-control" placeholder="Ej: Rojo">
              </div>

              <div class="col-md-3">
                <label class="form-label">C贸digo de barras</label>
                <input type="text" formControlName="codigoBarras" class="form-control" placeholder="EAN / interno">
              </div>

              <div class="col-md-3">
                <label class="form-label">Stock mayorista</label>
                <input type="number" formControlName="stockMayorista" class="form-control">
              </div>

              <div class="col-md-3 d-flex align-items-end">
                <button class="btn btn-outline-danger btn-sm" (click)="eliminarColor(i, j)">Eliminar color</button>
              </div>
            </div>

            <!--  Stock por sucursal -->
            <div formArrayName="stockSucursales" class="mt-2">
              <div *ngFor="let suc of getStockSucursales(i, j).controls; let s = index" [formGroupName]="s" class="d-flex align-items-center gap-2 mb-1">
                <label class="text-muted small w-25">{{ getNombreSucursal(suc.get('sucursalId')?.value) }}</label>
                <input type="number" formControlName="cantidad" class="form-control form-control-sm w-50">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--  Guardar -->
  <div class="mt-4 text-end">
    <button class="btn btn-success" (click)="guardarProductoModeloColor()">
      Guardar producto con variantes
    </button>
  </div>
</div>



</div>
