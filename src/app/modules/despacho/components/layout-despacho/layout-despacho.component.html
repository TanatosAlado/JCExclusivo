<div class="container mt-5 despacho-layout">
  <div class="row">

    <!-- 游늸 Columna izquierda: b칰squeda y cat치logo -->
    <div class="col-md-6 p-3 border-end">

      <!-- Buscar cliente (opcional) -->
      <div class="mb-3">
        <label class="form-label">Buscar cliente por DNI (opcional)</label>
        <div class="input-group">
          <input type="text" class="form-control" #dniInput placeholder="Ingrese DNI">
          <button class="btn btn-primary" (click)="buscarClientePorDNI(dniInput.value)">Buscar</button>
        </div>
        <div *ngIf="clienteActual" class="mt-2 alert alert-success p-2">
          Cliente: <strong>{{ clienteActual.nombre }}</strong> - Tipo: {{ clienteActual.tipo }}
        </div>
      </div>

      <hr>

      <!-- Escaneo c칩digo de barras -->
      <div class="mb-3">
        <label class="form-label">Escanear c칩digo de barras</label>
        <input type="text" class="form-control" #codigoInput placeholder="Escanee el producto"
               (keyup.enter)="procesarCodigoBarras(codigoInput.value); codigoInput.value=''" autofocus>
      </div>

      <!-- B칰squeda manual (solo si no se encontr칩 producto) -->
      <div *ngIf="modoBusquedaManual" class="mt-3">
        <label class="form-label">B칰squeda manual</label>
        <input type="text" class="form-control" [(ngModel)]="busquedaManual" placeholder="Buscar producto...">
        <!-- Lista de resultados -->
        <div *ngIf="busquedaManual.length > 2" class="mt-2">
          <!-- Aqu칤 ir칤a el *ngFor de productos filtrados desde Firebase -->
          <button class="btn btn-sm btn-outline-primary me-2" 
                  *ngFor="let prod of productosFiltrados"
                  (click)="agregarAlCarrito(prod)">
            {{ prod.nombre }}
          </button>
        </div>
      </div>

    </div>

    <!-- 游늸 Columna derecha: carrito -->
    <div class="col-md-6 p-3">

      <h5>游 Carrito</h5>

      <table class="table table-sm align-middle">
        <thead>
          <tr>
            <th>Producto</th>
            <th style="width: 100px;">Cant.</th>
            <th style="width: 120px;">Precio</th>
            <th style="width: 120px;">Subtotal</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of carrito; let i = index">
            <td>{{ item.nombre }}</td>
            <td>
              <input type="number" class="form-control form-control-sm" 
                     [(ngModel)]="item.cantidad" min="1"
                     (change)="editarCantidad(i, item.cantidad)">
            </td>
            <td>
              <input type="number" class="form-control form-control-sm" 
                     [(ngModel)]="item.precioUnitario" min="0"
                     (change)="editarPrecio(i, item.precioUnitario)">
            </td>
            <td>${{ item.subtotal | number:'1.2-2' }}</td>
            <td>
              <button class="btn btn-sm btn-danger" (click)="eliminarDelCarrito(i)">游딈</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <h4>Total: ${{ total | number:'1.2-2' }}</h4>
        <div>
          <button class="btn btn-secondary me-2" (click)="carrito=[]; total=0">Cancelar</button>
          <button class="btn btn-success" (click)="finalizarVenta()" [disabled]="carrito.length === 0">
            Finalizar Venta
          </button>
        </div>
      </div>

    </div>

  </div>
</div>
