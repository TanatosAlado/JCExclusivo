<!-- üîô VOLVER A LA TIENDA -->
<div class="volver-container">
  <button class="btn-volver" (click)="volverATienda()">
    ‚Üê Volver a la tienda
  </button>
</div>

<div class="container" *ngIf="producto">
  <!-- üñº Imagen -->
  <div class="left">
    <div class="image-container">
      <img [src]="imagenVisible" class="card-img-top" [alt]="producto.descripcion" />

    </div>
  </div>

  <!-- üìã Detalle -->
  <div class="right">
    <h3>{{ producto.descripcion }}</h3>
    <h5>{{ producto.subdescripcion }}</h5>

    <p *ngIf="producto.marca" class="text-muted">Marca: {{ producto.marca }}</p>

    <!-- üîπ Precio -->
    <div class="precios">
      <ng-container *ngIf="esMayorista; else vistaMinorista">
        <h3>{{ selectedVariante?.precioMayorista || producto.precioMayorista | currency }}</h3>
      </ng-container>

      <ng-template #vistaMinorista>
        <div *ngIf="producto.oferta; else sinOferta">
          <h3 class="text-danger">{{ producto.precioOferta | currency }}</h3>
          <del>{{ producto.precioMinorista | currency }}</del>
        </div>
        <ng-template #sinOferta>
          <h3>{{ producto.precioMinorista | currency }}</h3>
        </ng-template>
      </ng-template>
    </div>

    <!-- üé® Variantes -->
    <div *ngIf="producto.variantes?.length > 0" class="mt-3">

      <div *ngIf="producto.tipoVariantes === 'modelo' || producto.tipoVariantes === 'modelo+color'" class="mb-3">


        <div class="modelos-container">
          <button *ngFor="let modelo of modelosUnicos" class="btn btn-outline-primary btn-sm"
            (click)="seleccionarModelo(modelo)" [class.active]="modeloSeleccionado === modelo">
            {{ modelo }}
          </button>
        </div>
      </div>


      <div *ngIf="producto.tipoVariantes === 'color' || producto.tipoVariantes === 'modelo+color'">

        <div *ngIf="coloresFiltrados?.length > 0; else sinColores"
          class="d-flex flex-wrap gap-2 mt-2 colores-container">
          <div *ngFor="let variante of coloresFiltrados" class="d-flex align-items-center gap-2 color-wrapper">
            <div class="color-option" [title]="variante.color || '(sin color)'"
              [ngStyle]="{ 'background-color': (variante.color || '#ddd') }" (click)="seleccionarVariante(variante)"
              [class.selected]="selectedVariante === variante"
              style="width:28px;height:28px;border-radius:50%;border:1px solid #999;cursor:pointer">
            </div>
            <div class="color-wrapper position-relative">



            </div>

          </div>
        </div>


        <ng-template #sinColores>
          <div class="text-muted small mt-2">
            <em>Seleccione un modelo para ver los colores</em>
          </div>
        </ng-template>
      </div>


    </div>

    <!-- üü¶ Indicador de selecci√≥n -->
    <div *ngIf="producto.tipoVariantes === 'modelo+color' || producto.tipoVariantes === 'color'"
     class="seleccion-actual mt-3">

      <!-- Modelo seleccionado -->
      <div *ngIf="modeloSeleccionado" class="seleccion-item">
        <strong>Modelo:</strong> {{ modeloSeleccionado }}
      </div>

      <!-- Color seleccionado -->
      <div *ngIf="selectedVariante?.color" class="seleccion-item">
        <strong>Color:</strong> {{ selectedVariante.color }}
      </div>

      <!-- Si todav√≠a falta elegir algo -->
      <div *ngIf="producto.tipoVariantes === 'modelo+color' && (!modeloSeleccionado || !selectedVariante)"
        class="text-danger small mt-1">
        Debes seleccionar modelo y color para continuar.
      </div>

      <div *ngIf="producto.tipoVariantes === 'color' && !selectedVariante" class="text-danger small mt-1">
        Debes seleccionar un color para continuar.
      </div>

    </div>

    <div *ngIf="sinStock" class="text-danger mt-2">
      <strong>Sin stock disponible</strong>
    </div>

<div *ngIf="selectedVariante" class="text-muted mb-1">
  Stock disponible: <strong>{{ selectedVariante.stockTotal }}</strong>
</div>

    <!-- üõí Bot√≥n carrito -->
    <div class="carrito mt-4">
      <button (click)="disminuirCantidad()">-</button>
      <input type="text" [(ngModel)]="cantidad" readonly />
      <button (click)="aumentarCantidad()">+</button>

      <button class="agregar-carrito" (click)="cargaCarrito(producto)" [disabled]="!puedeAgregar()">
        AGREGAR AL CARRITO
      </button>
    </div>
  </div>
</div>