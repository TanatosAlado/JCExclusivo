<div class="product-item bg-light mb-4">
    <!-- 游뒆 Imagen principal -->
    <div class="product-img position-relative overflow-hidden">
        <img class="img-fluid w-100" [src]="
        selectedVariante?.imagen ||
        producto.imagen ||
        '../../../../../assets/imagenes/No disponible.png'
      " alt="Imagen producto" />

<div class="product-action">
  <!-- Mostrar bot칩n de carrito solo si no tiene variantes -->
  <a *ngIf="producto.tipoVariantes === 'none'; else carritoDeshabilitado"
     (click)="agregarCarrito(producto)"
     title="Agregar al carrito">
    <i class="fa fa-shopping-cart"></i>
  </a>

  <!-- Template para carrito deshabilitado (mismo 칤cono pero gris y con tooltip) -->
  <ng-template #carritoDeshabilitado>
    <a class="disabled" title="Producto con variantes. Abr칤 el detalle para seleccionar la variante">
      <i class="fa fa-shopping-cart"></i>
    </a>
  </ng-template>

  <!-- Lupa / Ver detalle (si tiene variantes mostramos tooltip que lo indique) -->
  <a (click)="verDetalle(producto)"
     [title]="producto.tipoVariantes && producto.tipoVariantes !== 'none' 
               ? 'Este producto tiene variantes. Abr칤 el detalle para elegir modelo/color.' 
               : 'Ver detalle del producto'">
    <i class="fa fa-search"></i>
  </a>
</div>
    </div>

    <!-- 游 Info del producto -->
    <div class="text-center py-4">
        <!-- Descripci칩n -->
        <a class="h6 text-decoration-none text-truncate" href="">
            {{ producto.descripcion }}
        </a>

        <!-- 游댳 Precios -->
        <ng-container *ngIf="esMayorista; else vistaMinorista">
            <div class="d-flex align-items-center justify-content-center mt-2">
                <h5>
                    {{
                    selectedVariante?.precioMayorista ||
                    producto.precioMayorista | currency
                    }}
                </h5>
            </div>
        </ng-container>

        <ng-template #vistaMinorista>
            <div class="d-flex align-items-center justify-content-center mt-2">
                <!-- Si est치 en oferta -->
                <ng-container *ngIf="selectedVariante?.oferta || producto.oferta; else sinOferta">
                    <h5>
                        {{
                        (selectedVariante?.precioOferta || producto.precioOferta)
                        | currency
                        }}
                    </h5>
                    <h6 class="text-muted ms-2">
                        <del>{{
                            (selectedVariante?.precioMinorista || producto.precioMinorista)
                            | currency
                            }}</del>
                    </h6>
                </ng-container>

                <!-- Si no est치 en oferta -->
                <ng-template #sinOferta>
                    <h5>
                        {{
                        (selectedVariante?.precioMinorista ||
                        producto.precioMinorista) | currency
                        }}
                    </h5>
                </ng-template>
            </div>

            <div class="small text-muted">
                Precio sin impuestos:
                {{ producto.precioSinImpuestos | currency }}
            </div>
        </ng-template>


        <!-- 游꿛 Variantes -->
        <!-- <div *ngIf="producto.variantes?.length > 0" class="mt-3">
       
            <div *ngIf="producto.tipoVariantes === 'modelo+color'" class="mb-3">
           
                <div class="modelos-container">
                    <button *ngFor="let modelo of modelosUnicos" class="btn btn-outline-primary btn-sm"
                        (click)="seleccionarModelo(modelo)" [class.active]="modeloSeleccionado === modelo">
                        {{ modelo }}
                    </button>
                </div>
            </div>

         
            <div *ngIf="producto.tipoVariantes === 'color' || producto.tipoVariantes === 'modelo+color'">
         
                <div *ngIf="coloresFiltrados?.length > 0; else sinColores" class="d-flex flex-wrap gap-2 mt-2 colores-container">
                    <div *ngFor="let variante of coloresFiltrados" class="d-flex align-items-center gap-2 color-wrapper">
                        <div class="color-option" [title]="variante.color || '(sin color)'"
                            [ngStyle]="{ 'background-color': (variante.color || '#ddd') }"
                            (click)="seleccionarVariante(variante)" [class.selected]="selectedVariante === variante"
                            style="width:28px;height:28px;border-radius:50%;border:1px solid #999;cursor:pointer">
                        </div>
                   
                    </div>
                </div>


                <ng-template #sinColores>
                    <div class="text-muted small mt-2">
                        <em>Seleccione un modelo para ver los colores</em>
                    </div>
                </ng-template>
            </div>


        </div> -->



        <!-- 游닍 Si no tiene variantes -->
        <!-- <div *ngIf="!producto.variantes?.length" class="mt-3 small text-muted">
            Stock total: {{ getStockTotal(producto) }}
        </div> -->
    </div>
</div>